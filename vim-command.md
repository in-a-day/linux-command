# **vim常用命令**

## **模式**
### **可视模式**
1. `vit` 选中标签内内容
2. `gv` 复选上一次选择
3. `o` 切换高亮选中的活动端(即非光标定位的一端),切换后, 该端作为选中的起始端

### **插入模式**
1. `<C-r>{register}` 插入寄存器内容
2. `<C-r><C-p>{register}` 插入寄存器内容
3. `<C-r>={expression}` 计算表达式的值并插入,例<C-r>=1+1, 将插入2.
4. `<C-v>{code}` ASCII码对应字符, 3位及以内, 如<C-v>065, 插入A
5. `<C-v>u{code}` ASCII码对应字符, 4位及以上
6. `<C-k>{char1}{char2} 二合字母, `:digraphs`查看, `:h digraph-table`, `:h digraphs-default`

### **命令行模式**
1. 命令行下可以使用`<C-r>{register}`插入寄存器内容
2. `<C-k>`和`<C-v>`输入特殊字符
3. `.`: 当前行, `%`: 全部行, `$`: 最后一行
4. `'<`: 可视模式选中的首行, `'>`: 可视模式选中末行, 即使退出可视模式任保留.
5. `/{pattern1}/,/{pattern2}/` 匹配开始的pattern, 到结束的pattern, 与输入`num1, num2`相同.
6. Offset(偏移), 相对于给定行的偏移, 如: `1,5+3`(第1行到第8行, 也可使用-减号), `.,/{pattern}/-1`(当前行到匹配模式的前一行)
7. `<C-r><C-w>` 将当前单词插入命令行
8. `<C-d>` 显示可用的命令行补全
9. `:shell` 打开一个shell, exit退出shell返回vim
10. 



命令 | 用途
--- | ---
`:[range]delete[x]` | 删除指定行[到寄存器x]
`:[range]yank[x]` | 复制指定行[到寄存器x]
`:[line]put[x]` | 在指定行后粘贴寄存器x内容
`:[range]copy[address]` (缩写:t) | 复制指定行到指定地址下
`:[range]move[address]` (缩写:m) | 移动指定行到指定地址下
`:[range]join` | 连接指定的行
`:[range]normal{commands}` | 在每个指定的行执行正常模式{command}
`:[range]substitute/{pattern}/{string}/[flags]` | 指定行用字符串替换匹配的模式
`:[range]global/{pattern}/[cmd]` | 在匹配的指定行执行Ex命令[cmd]
`:tabnew` | 新建窗口, 有`split`不同, 新建的是一个空窗口
`:prev/:next` | ???
`:bprev/bnext` | 缓冲区中的上一个/下一个
`:shell` | 启动shell(输入exit返回vim)
`:!{cmd}` | shell中执行{cmd}命令
`:read !{cmd}` | shell中执行{cmd}, 并将输出插入光标下方
`:[range]wirte !{cmd}` | shell中执行cmd, [range]作为标准输入
`:[range]!{filter}` | 使用外部程序过滤执行的[range]

- `[range]`可用模式:
  1. 数字: 1,3 1到3行
  2. pattern(模式): /{pat1}/, /{pat2}/ 表示匹配pat1到pat2之间行
  3. mark(标记): 'm1,'m2 包含标记m1到标记m2之间行
- `[range]`特殊:
  1. `.` 当前行
  2. `$` 最后行
  3. `'<` 可视模式的第一行, `'>`可视模式的最后一行
  4. `%` 全部行(命令行中也可以表示当前文件名称)
  5. `'m` 包含标记m的行
  6. `0` 虚拟的在文件首行之上的行
  7. `1` 第一行
  8. offset(偏移) `.,.+3`当前行到当前行的下3行, `/{pat1}/+1,/{pat2}/-1`匹配pat1的下一行到匹配pat2的上一行
  9. 当`[range]`省略时, 默认代表当前行

### **命令行窗口**
1. 命令行窗口中可以使用vim中的任意快捷键(命令行模式下不行)
2. 使用<C-R>将执行当前行的命令
3. 命令行窗口在活动窗口的上下文中执行. 活动窗口指调出命令前处于活动状态的窗口.

打开命令行窗口方法:
命令 | 动作
--- | ---
`q/` | 打开查找历史命令的命令行窗口
`q:` | 打开Ex命令的命令行窗口
`<C-f>` | 从命令行模式切换到命令行窗口(保留当前命令行的输入)




### **`.`命令**
1. `.` 命令重复上一次动作
2. 从插入模式到正常模式的所有动作都将被重复
3. `.` 命令相当于一个微型宏
4. `.范式` 一键移动, 一键执行

### **分割窗口**
1. `:split(sp)` 默认分割当前文件, 窗口为纵向分割
2. `:vsplit(vsp)` 横向分割

### **重复命令及其恢复命令**
内容 | 命令 | 重复 | 恢复
-- | -- | -- | --
修改 | {edit} | . | u
行查询下一个字符 | f{char}/t{char} | ; | ,
行查询上一个字符 | F{char}/T{char} | ; | ,
文档查询下一处匹配 | /pattern | n | N
文档查询上一处匹配 | ?pattern | n | N
替换 | s/target/replacement | & | u
执行一系列修改 | qx{changes}q | @x | u

`@:` 可以重复任意的Ex命令  
`:substitute`命令可以使用 `&` 重复执行上一次命令  

### **Operator + Motion = Action**
operator | 用途
--- | ---
`c` | 改变
`d` | 删除
`y` | 复制到寄存器
`g~` | 交换大小写
`gu` | 小写
`gU` | 大写
`gq` | 文本格式化
`g?` | ROT13编码(只对字母编码, 用当前字母向前数的第13个字母替换当前字母)
`g@` | 设置以`operatorfunc`选项调用方法
`zf` | 定义折叠
`~` | 交换大小写(只有设置了`tildeop`才行)
`\>` | 👉缩进
`\<` | 👈缩进
`=` | 自动缩进
`!` | 使用外部程序过滤{motion}所跨的行


## **文件**
### 文件与缓冲区
1. 文件存储与磁盘上, 缓冲区位于内存中
2. 大多vim操作使用缓冲区
3. 当切换缓冲区且未保存缓冲区的更改时, vim将未保存的缓冲区文件设置为隐藏缓冲区, 再退出时, 将会显示第一个隐藏缓冲区.

命令 | 动作
--- | ---
`:ls` | 显示缓冲区列表(%代表当前文件, #代表轮换文件)
`<C-^>` | 在当前文件与轮换文件切换
`:bnext` | 缓冲区下一个
`:bpre` | 缓冲区上一个
`:bfirst` | 缓冲区第一个
`:blast` | 缓冲区最后一个
`:buffer N` | 跳转到编号为N的缓冲区(编号由vim分配)
`:buffer {bufname}` | 以缓冲区名称跳转
`:bufdo` | 在ls列出的所有缓冲区上执行Ex命令
`:[range]bdelete{n1,...}` | 删除缓冲区(需要使用缓冲区编号去删除缓冲区)
`:w[rite]` | 将缓冲区内容写入磁盘
`:e[dit]` | 将磁盘内容写入缓冲区(即回滚修改)
`:qa[ll]` | 关闭所有窗口, 摈弃修改无视警告
`:wa[ll]` | 把所有改变的缓冲区写入磁盘

### **参数列表**
命令 | 动作
--- | ---
`:args{arglist}` | 列出参数列表(默认是在启动时作为参数传递给vim的列表, 如果{arglist}不为空, 则参数列表被替换为{arglist})
`:argdo` | 为args列出的参数列表执行Ex命令

- `{arglist}`
  1. 如果arglist中的文件不存在, 将会创建一个新的文件
  2. 可以使用*通配符
  3. **可以递归匹配, 即可以匹配子目录

### **窗口**
#### 分割窗口
命令 | 用途
--- | ---
`<C-w>s` | 水平分割当前窗口, 新窗口是当前缓冲区
`<C-w>v` | 垂直分割当前窗口, 新窗口是当前缓冲区
`:sp[lit]{filename}` | 水平切割当前窗口, 再新窗口中打开{file}
`:vsp[lit]{filename}` | 垂直切割当前窗口, 再新窗口中打开{file}

#### 切换窗口
命令 | 用途
--- | ---
`<C-w>w` | 循环切换窗口
`<C-w>j` | 下方窗口
`<C-w>h` | 左方窗口
`<C-w>k` | 上方窗口
`<C-w>l` | 右方窗口

#### 关闭窗口
Ex命令 | 普通命令 | 用途
`clo[se]` | `<C-w>c` | 关闭活动窗口
`on[ly]` | `<C-w>o` | 保留活动窗口, 关闭其他

#### 调整窗口
`:h window-resize` 查看文档
