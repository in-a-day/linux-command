# **vim常用命令**

## **模式**
### **可视模式**
1. `vit` 选中标签内内容
2. `gv` 复选上一次选择
3. `o` 切换高亮选中的活动端(即非光标定位的一端),切换后, 该端作为选中的起始端

### **插入模式**
1. `<C-r>{register}` 插入寄存器内容
2. `<C-r><C-p>{register}` 插入寄存器内容
3. `<C-r>={expression}` 计算表达式的值并插入,例<C-r>=1+1, 将插入2.
4. `<C-v>{code}` ASCII码对应字符, 3位及以内, 如<C-v>065, 插入A
5. `<C-v>u{code}` ASCII码对应字符, 4位及以上
6. `<C-k>{char1}{char2} 二合字母, `:digraphs`查看, `:h digraph-table`, `:h digraphs-default`

### **命令行模式**
1. 命令行下可以使用`<C-r>{register}`插入寄存器内容
2. `<C-k>`和`<C-v>`输入特殊字符
3. `.`: 当前行, `%`: 全部行, `$`: 最后一行
4. `'<`: 可视模式选中的首行, `'>`: 可视模式选中末行, 即使退出可视模式任保留.
5. `/{pattern1}/,/{pattern2}/` 匹配开始的pattern, 到结束的pattern, 与输入`num1, num2`相同.
6. Offset(偏移), 相对于给定行的偏移, 如: `1,5+3`(第1行到第8行, 也可使用-减号), `.,/{pattern}/-1`(当前行到匹配模式的前一行)
7. `<C-r><C-w>` 将当前单词插入命令行
8. `<C-d>` 显示可用的命令行补全
9. `:shell` 打开一个shell, exit退出shell返回vim

命令 | 用途
--- | ---
`:[range]delete[x]` | 删除指定行[到寄存器x]
`:[range]yank[x]` | 复制指定行[到寄存器x]
`:[line]put[x]` | 在指定行后粘贴寄存器x内容
`:[range]copy[address]` (缩写:t) | 复制指定行到指定地址下
`:[range]move[address]` (缩写:m) | 移动指定行到指定地址下
`:[range]join` | 连接指定的行
`:[range]normal{commands}` | 在每个指定的行执行正常模式{command}
`:[range]substitute/{pattern}/{string}/[flags]` | 指定行用字符串替换匹配的模式
`:[range]global/{pattern}/[cmd]` | 在匹配的指定行执行Ex命令[cmd]
`:tabnew` | 新建窗口, 有`split`不同, 新建的是一个空窗口
`:prev/:next` | ???
`:bprev/bnext` | 缓冲区中的上一个/下一个
`:shell` | 启动shell(输入exit返回vim)
`:!{cmd}` | shell中执行{cmd}命令
`:read !{cmd}` | shell中执行{cmd}, 并将输出插入光标下方
`:[range]wirte !{cmd}` | shell中执行cmd, [range]作为标准输入
`:[range]!{filter}` | 使用外部程序过滤执行的[range]
`:set {setting}?` | 查看{setting}的状态
`:set {setting}!` | 更改{setting}的状态为相反

- `[range]`可用模式:
  1. 数字: 1,3 1到3行
  2. pattern(模式): /{pat1}/, /{pat2}/ 表示匹配pat1到pat2之间行
  3. mark(标记): 'm1,'m2 包含标记m1到标记m2之间行
- `[range]`特殊:
  1. `.` 当前行
  2. `$` 最后行
  3. `'<` 可视模式的第一行, `'>`可视模式的最后一行
  4. `%` 全部行(命令行中也可以表示当前文件名称)
  5. `'m` 包含标记m的行
  6. `0` 虚拟的在文件首行之上的行
  7. `1` 第一行
  8. offset(偏移) `.,.+3`当前行到当前行的下3行, `/{pat1}/+1,/{pat2}/-1`匹配pat1的下一行到匹配pat2的上一行
  9. 当`[range]`省略时, 默认代表当前行

### **命令行窗口**
1. 命令行窗口中可以使用vim中的任意快捷键(命令行模式下不行)
2. 使用<C-R>将执行当前行的命令
3. 命令行窗口在活动窗口的上下文中执行. 活动窗口指调出命令前处于活动状态的窗口.

打开命令行窗口方法:
命令 | 动作
--- | ---
`q/` | 打开查找历史命令的命令行窗口
`q:` | 打开Ex命令的命令行窗口
`<C-f>` | 从命令行模式切换到命令行窗口(保留当前命令行的输入)




### **`.`命令**
1. `.` 命令重复上一次动作
2. 从插入模式到正常模式的所有动作都将被重复
3. `.` 命令相当于一个微型宏
4. `.范式` 一键移动, 一键执行

### **分割窗口**
1. `:split(sp)` 默认分割当前文件, 窗口为纵向分割
2. `:vsplit(vsp)` 横向分割

### **重复命令及其恢复命令**
内容 | 命令 | 重复 | 恢复
-- | -- | -- | --
修改 | {edit} | . | u
行查询下一个字符 | f{char}/t{char} | ; | ,
行查询上一个字符 | F{char}/T{char} | ; | ,
文档查询下一处匹配 | /pattern | n | N
文档查询上一处匹配 | ?pattern | n | N
替换 | s/target/replacement | & | u
执行一系列修改 | qx{changes}q | @x | u

`@:` 可以重复任意的Ex命令  
`:substitute`命令可以使用 `&` 重复执行上一次命令  

### **Operator + Motion = Action**
operator | 用途
--- | ---
`c` | 改变
`d` | 删除
`y` | 复制到寄存器
`g~` | 交换大小写
`gu` | 小写
`gU` | 大写
`gq` | 文本格式化
`g?` | ROT13编码(只对字母编码, 用当前字母向前数的第13个字母替换当前字母)
`g@` | 设置以`operatorfunc`选项调用方法
`zf` | 定义折叠
`~` | 交换大小写(只有设置了`tildeop`才行)
`\>` | 👉缩进
`\<` | 👈缩进
`=` | 自动缩进
`!` | 使用外部程序过滤{motion}所跨的行

---

## **文件**
### 文件与缓冲区
1. 文件存储与磁盘上, 缓冲区位于内存中
2. 大多vim操作使用缓冲区
3. 当切换缓冲区且未保存缓冲区的更改时, vim将未保存的缓冲区文件设置为隐藏缓冲区, 再退出时, 将会显示第一个隐藏缓冲区.

命令 | 动作
--- | ---
`:ls` | 显示缓冲区列表(%代表当前文件, #代表轮换文件)
`<C-^>` | 在当前文件与轮换文件切换
`:bnext` | 缓冲区下一个
`:bpre` | 缓冲区上一个
`:bfirst` | 缓冲区第一个
`:blast` | 缓冲区最后一个
`:buffer N` | 跳转到编号为N的缓冲区(编号由vim分配)
`:buffer {bufname}` | 以缓冲区名称跳转
`:bufdo` | 在ls列出的所有缓冲区上执行Ex命令
`:[range]bdelete{n1,...}` | 删除缓冲区(需要使用缓冲区编号去删除缓冲区)
`:w[rite]` | 将缓冲区内容写入磁盘
`:e[dit]` | 将磁盘内容写入缓冲区(即回滚修改)
`:qa[ll]` | 关闭所有窗口, 摈弃修改无视警告
`:wa[ll]` | 把所有改变的缓冲区写入磁盘

### **参数列表**
命令 | 动作
--- | ---
`:args{arglist}` | 列出参数列表(默认是在启动时作为参数传递给vim的列表, 如果{arglist}不为空, 则参数列表被替换为{arglist})
`:argdo` | 为args列出的参数列表执行Ex命令

- `{arglist}`
  1. 如果arglist中的文件不存在, 将会创建一个新的文件
  2. 可以使用*通配符
  3. **可以递归匹配, 即可以匹配子目录

### **窗口**
#### 分割窗口
命令 | 用途
--- | ---
`<C-w>s` | 水平分割当前窗口, 新窗口是当前缓冲区
`<C-w>v` | 垂直分割当前窗口, 新窗口是当前缓冲区
`:sp[lit]{filename}` | 水平切割当前窗口, 再新窗口中打开{file}
`:vsp[lit]{filename}` | 垂直切割当前窗口, 再新窗口中打开{file}

#### 切换窗口
命令 | 用途
--- | ---
`<C-w>w` | 循环切换窗口
`<C-w>j` | 下方窗口
`<C-w>h` | 左方窗口
`<C-w>k` | 上方窗口
`<C-w>l` | 右方窗口

#### 关闭窗口
Ex命令 | 普通命令 | 用途
`clo[se]` | `<C-w>c` | 关闭活动窗口
`on[ly]` | `<C-w>o` | 保留活动窗口, 关闭其他

#### 调整窗口
`:h window-resize` 查看文档

### **移动及跳转**
命令 | 光标动作
--- | ---
`gj` | 移动到屏幕下一行
`gk` | 移动到屏幕上一行
`go` | 移动到屏幕行行首
`g^` | 移动到屏幕行第一个非空字符
`g$` | 移动到屏幕行尾
`ge` | 反向移动到上一单词结尾

#### **查找字符**
命令 | 用途
--- | ---
`f{char}` | 查找下一个{char}, 光标停留{char}
`F{char}` | 查找上一个{char}, 光标停留{char}
`t{char}` | 查找下一个{char}, 光标停留{char}前
`T{char}` | 查找上一个{char}, 光标停留{char}后
`;` | 重复上一次查找
`,` | 反向查找

技巧: `d/word` 将删除光标到word之前的内容

#### **分隔符文本对象**
1. vim的文本对象由两个字符组成, 第一个字符永远是i或a, i选择分隔符内部文本, a选择包含分隔符文本

文本对象 | 选择区域
--- | ---
`a)或ab` | 一对圆括号
`i)或ib` | 圆括号内
`a}或aB` | 一对括号内
`i}或iB` | 花括号内
`at` | 一对xml标签
`it` | xml标签内

tips: 仅列出含有缩写, 分隔符使用左还是右相同(即`[`与`]`相同)

#### **范围文本对象**
文本对象 | 选择区域
--- | ---
`iw` | 当前单词
`aw` | 当前单词及一个空格(其后的任意空白符)
`iW` | 当前字串
`aW` | 当前字串及一个空格
`is` | 当前句子
`as` | 当前句子及一个空格
`ip` | 当前段落
`ap` | 当前段落及一个空行

#### **标记**
1. m{a-zA-Z} 选定字母标记当前光标所在位置, 小写字母仅当前缓冲区可见, 大写字母全局可见
2. \'{mark} 跳转到mark标记的行
3. \`{mark} 跳转到mark标记的行列

vim 自动标记及跳转
标记 | 跳转
--- | ---
\`\` | 当前文件中上次跳转动作之前的位置
\`. | 上次修改的地方
\`^ | 上次插入的地方
\`[ | 上次修改或复制起始位置
\`] | 上次修改或复制结束位置
\`< | 上次高亮选区起始位置
\`> | 上次高亮选区结束位置

#### **跳转列表**
1. vim会记录跳转前后的位置, 并提供命令进行跳转.
2. `:jumps` 查看跳转列表
3. `<C-o>` 跳转列表上一个
4. `<C-i>` 跳转列表下一个
5. 插入模式下`<C-i>` 与 `<Tab>`映射相同

一些跳转列表会记录的命令
命令 | 用途
--- | ---
`[count]G` | 跳转到[count]行
`/pattern<CR>/?pattern<CR>/n/N` | 跳转到下一个/上一个模式出现之处
`%` | 跳转到匹配之处
`(`/`)` | 跳转到上一句/下一句开头
`{`/`}` | 跳转到上一段/下一段开头
`H/M/L` | 跳转到屏幕上/中/下
`gf` | 跳转到光标下的文件名
`<C-]>` | 跳转到光标下关键字定义之处
\`{mark}/'{mark} | 跳转到标记处

#### **改变列表**
1. 改变文档时, vim会记录改变光标的位置
2. `:changes` 查看改变列表
3. `g;` 反向遍历改变列表
4. `g,` 正向遍历改变列表
5. `gi` 跳转到上次退出插入模式的位置, 并进入插入模式, 相当于\`^i


### **寄存器**
#### **常用寄存器**
寄存器 | 内容
--- | ---
`""` | 默认寄存器
`"0` | 复制寄存器(复制时, 默认会添加一份到该寄存器)
`"+` | 系统寄存器
`"*` | 系统寄存器, X11中使用, 在windows与mac os中同上
`"_` | 黑洞寄存器
`"=` | 表达式寄存器
`"%` | 当前文件名
`"#` | 轮换文件名
`".` | 上次插入文本
`":` | 上次执行的Ex命令
`"/` | 上次查找的模式

tips: 
1. 除此之外, vim提供`"a-"z`26个有名寄存器
2. 在可视模式下, vim的`p`命令将会用指定寄存器内容替换高亮选中区的文本. 但是替换后寄存器的内容将变为被替换的文本.
3. `p`将寄存器内容复制到光标后, `P`复制到光标前.
4. `gp` 与 `gP`与上相似, 但是复制后光标位置有所不同

#### **宏**
1. `q{register}` 录制/结束录制宏到指定寄存器
2. `@{register}` 执行寄存器中的宏
3. `@@` 重复执行上一个宏
4. 串行执行宏时, 如果遇到错误将会中断
5. 使用`[range] normal @{register}`并行执行宏, 遇到错误将会继续执行下一行.
6. 使用`qa` 录制宏, 完成后若想要添加命令使用`qA`
7. 宏命令可以复制文本修改, 然后将文本重新保存至宏宏寄存器中